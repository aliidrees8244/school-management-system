<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Report Card - Muslim Educators School Kot Hussain</title>
  <style>
    /* Reset & base */
    * {
      box-sizing: border-box;
    }
    body {
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      background: #f9faff;
      margin: 0;
      padding: 0;
      color: #1a1a1a;
    }
    .container {
      max-width: 900px;
      background: white;
      margin: 30px auto;
      padding: 30px 40px;
      border: 2px solid #003366;
      border-radius: 10px;
      box-shadow: 0 4px 10px rgb(0 0 0 / 0.1);
    }
    header {
      display: flex;
      align-items: center;
      margin-bottom: 25px;
      border-bottom: 2px solid #003366;
      padding-bottom: 15px;
    }
    header img {
      height: 70px;
      margin-right: 20px;
    }
    header h1 {
      font-size: 1.8rem;
      color: #003366;
      margin: 0;
      font-weight: 700;
      flex-grow: 1;
    }
    .dashboard-link {
      display: inline-block;
      margin-bottom: 25px;
      color: #003366;
      font-weight: 600;
      text-decoration: none;
      font-size: 1rem;
      transition: color 0.3s;
    }
    .dashboard-link:hover {
      color: #001f4d;
      text-decoration: underline;
    }
    label {
      display: block;
      margin: 15px 0 6px;
      font-weight: 600;
      color: #003366;
      font-size: 1rem;
    }
    select {
      width: 100%;
      padding: 10px 12px;
      font-size: 1rem;
      border: 1.8px solid #003366;
      border-radius: 5px;
      outline: none;
      cursor: pointer;
      transition: border-color 0.3s;
    }
    select:focus {
      border-color: #001f4d;
    }
    /* Student & Exam info sections */
    .info-section {
      margin-top: 30px;
      padding: 15px 25px;
      background-color: #e6f0ff;
      border-radius: 8px;
      border: 1.5px solid #003366;
      color: #003366;
      font-weight: 600;
      font-size: 1.05rem;
    }
    .info-section span {
      font-weight: 700;
      color: #001f4d;
    }
    /* Table styling */
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 30px;
      box-shadow: 0 2px 8px rgb(0 0 0 / 0.1);
    }
    th, td {
      padding: 14px 18px;
      border: 1.5px solid #003366;
      text-align: center;
      font-size: 1rem;
    }
    th {
      background-color: #003366;
      color: white;
      font-weight: 700;
      text-transform: uppercase;
    }
    tbody tr:nth-child(even) {
      background-color: #f2f8ff;
    }
    tbody tr:hover {
      background-color: #d7e4ff;
    }
    /* Summary section */
    .summary {
      margin-top: 25px;
      font-size: 1.15rem;
      font-weight: 700;
      color: #003366;
      text-align: right;
      letter-spacing: 0.04em;
    }
    /* Buttons */
    button#printBtn {
      margin-top: 35px;
      padding: 12px 30px;
      font-weight: 700;
      font-size: 1rem;
      background-color: #003366;
      color: white;
      border: none;
      border-radius: 7px;
      cursor: pointer;
      transition: background-color 0.3s;
      display: none;
      float: right;
    }
    button#printBtn:hover {
      background-color: #001f4d;
    }
    /* Responsive */
    @media (max-width: 600px) {
      .container {
        padding: 20px 15px;
      }
      th, td {
        padding: 10px 8px;
        font-size: 0.9rem;
      }
      button#printBtn {
        width: 100%;
        float: none;
      }
    }
    /* Print styles */
    @media print {
      button#printBtn,
      select,
      .dashboard-link {
        display: none !important;
      }
      body {
        background: white;
      }
      .container {
        box-shadow: none;
        border: none;
        margin: 0;
        padding: 0;
        max-width: 100%;
      }
    }
  </style>
</head>
<body>
  <div class="container">

    <header>
      <img src="logo.png" alt="School Logo" onerror="this.style.display='none'" />
      <h1>Muslim Educators School Kot Hussain</h1>
    </header>

    <a href="index.html" class="dashboard-link">Â« Back to Dashboard</a>

    <label for="studentSelect">Select Student:</label>
    <select id="studentSelect" required>
      <option value="">-- Select Student --</option>
    </select>

    <label for="examSelect">Select Exam:</label>
    <select id="examSelect" required>
      <option value="">-- Select Exam --</option>
    </select>

    <div id="studentInfo" class="info-section" style="display:none;">
      <p><strong>Student Name:</strong> <span id="studentName"></span></p>
      <p><strong>Class:</strong> <span id="studentClass"></span></p>
      <p><strong>Father's Name:</strong> <span id="studentFather"></span></p>
      <p><strong>Contact:</strong> <span id="studentContact"></span></p>
    </div>

    <div id="examInfo" class="info-section" style="display:none;">
      <p><strong>Exam Type:</strong> <span id="examType"></span></p>
      <p><strong>Date:</strong> <span id="examDate"></span></p>
    </div>

    <table id="marksTable" style="display:none;">
      <thead>
        <tr>
          <th>Subject</th>
          <th>Marks Obtained</th>
          <th>Maximum Marks</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <div class="summary" id="summary" style="display:none;"></div>

    <button id="printBtn">Print Report Card</button>
  </div>

  <script>
    const studentSelect = document.getElementById('studentSelect');
    const examSelect = document.getElementById('examSelect');
    const marksTable = document.getElementById('marksTable');
    const marksTableBody = marksTable.querySelector('tbody');
    const summaryDiv = document.getElementById('summary');
    const printBtn = document.getElementById('printBtn');

    const studentInfoDiv = document.getElementById('studentInfo');
    const examInfoDiv = document.getElementById('examInfo');

    const studentNameSpan = document.getElementById('studentName');
    const studentClassSpan = document.getElementById('studentClass');
    const studentFatherSpan = document.getElementById('studentFather');
    const studentContactSpan = document.getElementById('studentContact');

    const examTypeSpan = document.getElementById('examType');
    const examDateSpan = document.getElementById('examDate');

    // Load students into dropdown
    function loadStudents() {
      const students = JSON.parse(localStorage.getItem('registrations')) || [];
      studentSelect.innerHTML = '<option value="">-- Select Student --</option>';
      students.forEach(student => {
        const option = document.createElement('option');
        option.value = student.studentName;
        option.textContent = `${student.studentName} - Class ${student.class}`;
        studentSelect.appendChild(option);
      });
    }

    // Load exams into dropdown
    function loadExams() {
      const exams = JSON.parse(localStorage.getItem('exams')) || [];
      examSelect.innerHTML = '<option value="">-- Select Exam --</option>';
      exams.forEach(exam => {
        const option = document.createElement('option');
        option.value = exam.type;
        option.textContent = `${exam.type} - Class ${exam.class} (${exam.date})`;
        examSelect.appendChild(option);
      });
    }

    // Show student details section
    function showStudentInfo(studentName) {
      const students = JSON.parse(localStorage.getItem('registrations')) || [];
      const student = students.find(s => s.studentName === studentName);
      if (!student) {
        studentInfoDiv.style.display = 'none';
        return;
      }
      studentNameSpan.textContent = student.studentName;
      studentClassSpan.textContent = student.class;
      studentFatherSpan.textContent = student.fatherName || 'N/A';
      studentContactSpan.textContent = student.contact || 'N/A';
      studentInfoDiv.style.display = 'block';
    }

    // Show exam details section
    function showExamInfo(examType) {
      const exams = JSON.parse(localStorage.getItem('exams')) || [];
      const exam = exams.find(e => e.type === examType);
      if (!exam) {
        examInfoDiv.style.display = 'none';
        return;
      }
      examTypeSpan.textContent = exam.type;
      examDateSpan.textContent = exam.date || 'N/A';
      examInfoDiv.style.display = 'block';
    }

    // Load and display marks
    function loadMarks(studentName, examType) {
      if (!studentName || !examType) {
        marksTable.style.display = 'none';
        summaryDiv.style.display = 'none';
        printBtn.style.display = 'none';
        return;
      }

      const marks = JSON.parse(localStorage.getItem('marks')) || [];
      const filteredMarks = marks.filter(m => m.studentName === studentName && m.examType === examType);

      if (filteredMarks.length === 0) {
        marksTable.style.display = 'none';
        summaryDiv.style.display = 'none';
        printBtn.style.display = 'none';
        alert("No marks found for this student & exam.");
        return;
      }

      marksTableBody.innerHTML = '';
      marksTable.style.display = '';
      summaryDiv.style.display = '';
      printBtn.style.display = '';

      let totalObtained = 0;
      let totalMax = 0;

      filteredMarks.forEach(mark => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${mark.subject}</td>
          <td>${mark.marksObtained}</td>
          <td>${mark.maxMarks}</td>
        `;
        marksTableBody.appendChild(tr);
        totalObtained += Number(mark.marksObtained);
        totalMax += Number(mark.maxMarks);
      });

      const percentage = ((totalObtained / totalMax) * 100).toFixed(2);
      let grade = '';

      if (percentage >= 90) grade = 'A+';
      else if (percentage >= 80) grade = 'A';
      else if (percentage >= 70) grade = 'B';
      else if (percentage >= 60) grade = 'C';
      else if (percentage >= 50) grade = 'D';
      else grade = 'F';

      summaryDiv.innerHTML = `
        Total Marks: <strong>${totalObtained} / ${totalMax}</strong> &nbsp;|&nbsp;
        Percentage: <strong>${percentage}%</strong> &nbsp;|&nbsp;
        Grade: <strong>${grade}</strong>
      `;
    }

    // Handle dropdown changes
    function onSelectionChange() {
      const studentName = studentSelect.value;
      const examType = examSelect.value;

      if (studentName && examType) {
        showStudentInfo(studentName);
        showExamInfo(examType);
        loadMarks(studentName, examType);
      } else {
        studentInfoDiv.style.display = 'none';
        examInfoDiv.style.display = 'none';
        marksTable.style.display = 'none';
        summaryDiv.style.display = 'none';
        printBtn.style.display = 'none';
      }
    }

    studentSelect.addEventListener('change', onSelectionChange);
    examSelect.addEventListener('change', onSelectionChange);

    printBtn.addEventListener('click', () => {
      window.print();
    });

    // Initial load
    loadStudents();
    loadExams();
  </script>
</body>
</html>
