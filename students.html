<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>View Students - Muslim Educators School Kot Hussain</title>
  <style>
    /* Reset and base */
    *, *::before, *::after {
      box-sizing: border-box;
    }
    body {
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      background: #f9fafb;
      margin: 20px;
      color: #212121;
      line-height: 1.4;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }
    h1 {
      color: #003366;
      text-align: center;
      margin-bottom: 25px;
      font-weight: 700;
      user-select: none;
    }
    .top-buttons {
      text-align: center;
      margin-bottom: 25px;
    }
    .top-buttons a {
      background-color: #003366;
      color: #fff;
      text-decoration: none;
      padding: 12px 22px;
      margin: 0 10px;
      border-radius: 6px;
      font-weight: 700;
      font-size: 1rem;
      display: inline-block;
      box-shadow: 0 3px 8px rgba(0, 51, 102, 0.25);
      transition: background-color 0.3s ease, box-shadow 0.3s ease;
      user-select: none;
    }
    .top-buttons a:hover,
    .top-buttons a:focus {
      background-color: #001f4d;
      box-shadow: 0 5px 15px rgba(0, 31, 77, 0.6);
      outline: none;
    }
    table {
      max-width: 1100px;
      width: 100%;
      margin: 0 auto 40px auto;
      border-collapse: separate;
      border-spacing: 0;
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 6px 16px rgba(0, 0, 0, 0.1);
      background: #fff;
    }
    thead tr {
      background-color: #003366;
      color: white;
      font-weight: 700;
      user-select: none;
    }
    th, td {
      padding: 14px 18px;
      text-align: left;
      vertical-align: middle;
      border-bottom: 1px solid #e1e8f0;
      font-size: 0.95rem;
    }
    tbody tr:hover {
      background-color: #eaf6ff;
      cursor: default;
    }
    tbody tr:last-child td {
      border-bottom: none;
    }
    /* Responsive */
    @media (max-width: 900px) {
      table {
        font-size: 0.85rem;
      }
      th, td {
        padding: 10px 12px;
      }
    }
    @media (max-width: 700px) {
      table, thead, tbody, th, td, tr {
        display: block;
      }
      thead tr {
        position: absolute;
        top: -9999px;
        left: -9999px;
      }
      tr {
        margin-bottom: 18px;
        background: white;
        border-radius: 10px;
        box-shadow: 0 3px 10px rgba(0,0,0,0.07);
        padding: 15px;
      }
      td {
        border: none;
        position: relative;
        padding-left: 50%;
        text-align: left;
      }
      td::before {
        position: absolute;
        top: 14px;
        left: 15px;
        width: 45%;
        padding-left: 0;
        font-weight: 700;
        white-space: nowrap;
        content: attr(data-label);
        color: #555;
      }
      .actions-wrapper {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        margin-top: 10px;
      }
    }
    /* Buttons styles */
    .btn, button, a.action-btn {
      font-family: inherit;
      font-weight: 600;
      font-size: 0.9rem;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      padding: 8px 14px;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      user-select: none;
      transition: background-color 0.3s ease, box-shadow 0.3s ease;
      box-shadow: 0 2px 6px rgba(0,0,0,0.12);
    }
    .btn:focus-visible, button:focus-visible, a.action-btn:focus-visible {
      outline: 3px solid #159d86;
      outline-offset: 2px;
    }
    .edit-btn {
      background-color: #0077b6;
      color: white;
    }
    .edit-btn:hover, .edit-btn:focus {
      background-color: #005f87;
      box-shadow: 0 4px 12px rgba(0,123,182,0.45);
    }
    .delete-btn {
      background-color: #d90429;
      color: white;
    }
    .delete-btn:hover, .delete-btn:focus {
      background-color: #a1021d;
      box-shadow: 0 4px 12px rgba(217,4,41,0.55);
    }
    .whatsapp-btn {
      background-color: #25d366;
      color: white;
      font-weight: 700;
    }
    .whatsapp-btn:hover, .whatsapp-btn:focus {
      background-color: #128c34;
      box-shadow: 0 4px 12px rgba(18,140,52,0.55);
    }
    /* WhatsApp icon */
    .whatsapp-icon {
      width: 18px;
      height: 18px;
      fill: white;
      user-select: none;
    }
  </style>
</head>
<body>
  <h1>Registered Students</h1>
  <div class="top-buttons">
    <a href="index.html" class="btn" aria-label="Go to main dashboard">¬´ Main Dashboard</a>
    <a href="student-registration.html" class="btn" aria-label="Add new student">+ Add New Student</a>
  </div>

  <table id="studentsTable" role="table" aria-label="List of registered students">
    <thead>
      <tr>
        <th scope="col">Student Name</th>
        <th scope="col">Father's Name</th>
        <th scope="col">Class</th>
        <th scope="col">Section</th>
        <th scope="col">Gender</th>
        <th scope="col">Date of Birth</th>
        <th scope="col">Contact Number</th>
        <th scope="col">Guardian Name</th>
        <th scope="col">Guardian Contact</th>
        <th scope="col">Actions</th>
      </tr>
    </thead>
    <tbody>
      <!-- Student rows inserted here -->
    </tbody>
  </table>

  <script>
    // Generate WhatsApp URL with message
    function getWhatsAppLink(phoneNumber, message) {
      if (!phoneNumber) return "#";
      let cleaned = phoneNumber.replace(/\D/g, "");
      if (cleaned.startsWith("0")) cleaned = "92" + cleaned.slice(1);
      if (!cleaned.startsWith("92")) cleaned = "92" + cleaned;
      const encodedMessage = encodeURIComponent(message);
      return `https://wa.me/${cleaned}?text=${encodedMessage}`;
    }

    function loadStudents() {
      const students = JSON.parse(localStorage.getItem("registrations")) || [];
      const tbody = document.querySelector("#studentsTable tbody");
      tbody.innerHTML = "";

      if (students.length === 0) {
        tbody.innerHTML = `<tr><td colspan="10" style="text-align:center; padding: 20px; font-style: italic;">No students registered yet.</td></tr>`;
        return;
      }

      students.forEach((student, index) => {
        const waMessage = `Assalamu Alaikum. Dear ${student.guardianName || student.fatherName || student.studentName}, this is a notification from Muslim Educators School & Science Academy Kot Hussain.`;
        const waLink = getWhatsAppLink(student.guardianContact || student.contactNumber, waMessage);

        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td data-label="Student Name">${student.studentName}</td>
          <td data-label="Father's Name">${student.fatherName}</td>
          <td data-label="Class">${student.class}</td>
          <td data-label="Section">${student.section}</td>
          <td data-label="Gender">${student.gender}</td>
          <td data-label="Date of Birth">${student.dob}</td>
          <td data-label="Contact Number">${student.contactNumber}</td>
          <td data-label="Guardian Name">${student.guardianName}</td>
          <td data-label="Guardian Contact">${student.guardianContact}</td>
          <td data-label="Actions">
            <button type="button" class="btn edit-btn" data-index="${index}" aria-label="Edit student ${student.studentName}">‚úèÔ∏è Edit</button>
            <button type="button" class="btn delete-btn" data-index="${index}" aria-label="Delete student ${student.studentName}">üóëÔ∏è Delete</button>
            <a href="${waLink}" target="_blank" rel="noopener noreferrer" class="btn whatsapp-btn" aria-label="Send WhatsApp message to ${student.guardianName || student.fatherName || student.studentName}">
              <svg class="whatsapp-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                <path d="M20.52 3.48A11.94 11.94 0 0012 0C5.37 0 .01 5.36.01 12a11.91 11.91 0 002.31 7.23L0 24l4.86-2.48a11.89 11.89 0 007.14 2.42c6.62 0 12-5.37 12-12 0-3.18-1.24-6.16-3.48-8.46zm-8.52 16.02a9.6 9.6 0 01-5.13-1.46l-.37-.22-3 1.53 1.6-3.03-.24-.39a9.72 9.72 0 01-1.53-5.04c0-5.35 4.35-9.7 9.7-9.7 2.6 0 5.04 1.02 6.87 2.86a9.65 9.65 0 012.84 6.83c0 5.35-4.35 9.7-9.7 9.7zm5.4-7.36c-.3-.15-1.76-.87-2.04-.97-.27-.1-.46-.15-.66.15-.2.3-.77.97-.95 1.17-.17.2-.34.22-.64.08-.3-.15-1.27-.47-2.42-1.49-.9-.8-1.5-1.78-1.67-2.08-.17-.3-.02-.46.13-.61.13-.13.3-.34.45-.51.15-.17.2-.28.3-.46.1-.17.05-.32-.02-.46-.07-.15-.66-1.58-.9-2.18-.24-.57-.48-.5-.66-.51-.17-.01-.37-.01-.57-.01-.2 0-.52.07-.79.32-.27.24-1.04 1.02-1.04 2.5s1.07 2.9 1.22 3.1c.15.2 2.11 3.22 5.12 4.52.72.31 1.28.5 1.72.64.72.23 1.38.2 1.9.12.58-.1 1.76-.72 2.01-1.42.25-.7.25-1.3.17-1.42-.07-.13-.27-.2-.57-.35z"/>
              </svg>
              WhatsApp
            </a>
          </td>
        `;
        tbody.appendChild(tr);
      });

      // Edit button event
      document.querySelectorAll(".edit-btn").forEach(btn => {
        btn.addEventListener("click", (e) => {
          const idx = e.target.getAttribute("data-index");
          const students = JSON.parse(localStorage.getItem("registrations")) || [];
          localStorage.setItem("editStudentIndex", idx);
          localStorage.setItem("editStudentData", JSON.stringify(students[idx]));
          window.location.href = "student-registration.html";
        });
      });

      // Delete button event
      document.querySelectorAll(".delete-btn").forEach(btn => {
        btn.addEventListener("click", (e) => {
          const idx = e.target.getAttribute("data-index");
          if (confirm("Are you sure you want to delete this student?")) {
            let students = JSON.parse(localStorage.getItem("registrations")) || [];
            students.splice(idx, 1);
            localStorage.setItem("registrations", JSON.stringify(students));
            loadStudents();
          }
        });
      });
    }

    loadStudents();
  </script>
</body>
</html>
